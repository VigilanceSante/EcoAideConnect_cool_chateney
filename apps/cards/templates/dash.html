{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Tableau de Bord Qualité de l'air{% endblock %}

{% block content %}
<style>
  /* Body Styles */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background-color: #f9f9f9;
    color: #333;
    margin: 0;
    padding: 0;
  }

  /* Dashboard Container */
  .dashboard-container {
    max-width: 1400px;
    margin: auto;
    padding: 30px;
    background-color: #fff;
    box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.1);
  }

  /* Dashboard Header */
  .dashboard-header {
    text-align: center;
    font-weight: 600;
    font-size: 32px;
    padding: 10px;
    color: #007aff;
  }

  /* Pollen and Pollution Sections */
  .info-sections {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: space-between;
  }

  /* Info Card Styles */
  .info-card,
  .weather-card {
    background-color: #f1f1f1;
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    width: 48%;
    box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s ease, background-color 0.3s ease;
    position: relative;
  }

  .info-card:hover,
  .weather-card:hover {
    transform: translateY(-5px);
    background-color: #fafafa;
  }

  .info-card h6,
  .weather-card h6 {
    font-size: 20px;
    margin-bottom: 10px;
    color: #333;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .info-card h6 .icon,
  .weather-card h6 .icon {
    margin-right: 8px;
    font-size: 22px;
  }

  /* Info Icon Styles */
  .info-icon {
    position: relative;
    display: inline-block;
    margin-left: 8px;
    cursor: pointer;
    color: #007aff;
    font-size: 16px;
    border: 1px solid #007aff;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    line-height: 16px;
    text-align: center;
    font-weight: bold;
  }

  /* Tooltip Styles */
  .tooltip {
    visibility: hidden;
    width: 220px;
    background-color: #333;
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -110px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  /* Tooltip Arrow */
  .tooltip::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
  }

  /* Show Tooltip on Hover */
  .info-icon:hover .tooltip,
  .info-icon:focus .tooltip {
    visibility: visible;
    opacity: 1;
  }

  .info-card .info-value,
  .weather-card .weather-info {
    font-size: 28px;
    font-weight: bold;
    color: #007aff;
    margin-bottom: 5px;
  }

  .info-card .pollution-category,
  .info-card .pollen-levels,
  .weather-card .weather-details {
    margin-top: 10px;
    text-align: left;
    font-size: 14px;
    color: #555;
  }

  /* Recommendations for Vulnerable Individuals */
  .recommendations {
    margin-top: 15px;
    padding: 10px;
    background-color: #ffe5e5;
    border-left: 5px solid #ff3b30;
    font-size: 14px;
    color: #c40000;
  }

  /* Air Quality Levels and Pollens */
  .faible {
    color: #34c759 !important;
  }

  .moyen {
    color: #ffcc00 !important;
  }

  .degrade {
    color: #ff9500 !important;
  }

  .mauvais {
    color: #ff3b30 !important;
  }

  .tres-mauvais {
    color: #c40000 !important;
  }

  /* Legend for Air Quality Levels */
  .legend {
    margin-top: 30px;
    font-size: 16px;
    text-align: center;
  }

  .legend div {
    display: inline-block;
    margin: 0 10px;
    padding: 8px 12px;
    border-radius: 5px;
    color: #fff;
  }

  .legend h6 {
    font-size: 18px;
    margin-bottom: 10px;
    color: #333;
  }

  /* Responsive Design */
  @media (max-width: 768px) {

    .info-card,
    .weather-card {
      width: 100%;
      /* Stack tiles on smaller screens */
    }
  }
</style>

<div class="dashboard-container">
  <div class="dashboard-header"> En direct de Châtenay-Malabry</div>

  <!-- Pollen and Pollution Sections -->
  <div class="info-sections">
      <!-- Weather Section -->
      <div class="info-card">
        <h6>
          <i class="fas fa-sun icon"></i>
          Météo Actuelle
          <span class="info-icon" tabindex="0" aria-describedby="tooltip-weather">
            i
            <span class="tooltip" role="tooltip" id="tooltip-weather">
              Informations sur les conditions météorologiques actuelles. Une chaleur excessive peut entraîner des coups de
              chaleur, tandis qu'un froid extrême peut provoquer l'hypothermie.
            </span>
          </span>
        </h6>
        
        <div class="weather-summary">
          Aujourd'hui, le vent souffle à {{ wind_speed }} km/h. La température varie de {{ min_temp }}°C à {{ max_temp }}°C avec une température ressentie de {{ feel_like }}°C.
        </div>
        
        {% if temperature >= 25 or temperature < 5 %}
          <div class="recommendations">
            <strong>Recommandations Météo :</strong>
            {% if temperature >= 35 %}
              <p>Il fait extrêmement chaud. Buvez beaucoup d'eau, évitez les activités physiques et restez dans un endroit frais.</p>
            {% elif temperature >= 25 %}
              <p>Il fait chaud. Portez des vêtements légers et buvez régulièrement de l'eau.</p>
            {% elif temperature < 5 %}
              <p>Il fait froid. Habillez-vous chaudement et évitez les sorties prolongées sans protection appropriée.</p>
            {% endif %}
          </div>
        {% endif %}
    </div>

  <!-- Particulate Matter Pollution Tile -->
  <div class="info-card">
    <h6>
      <i class="fas fa-cloud icon"></i>
      Particules en suspension
      <span class="info-icon" tabindex="0" aria-describedby="tooltip-pm">
        i
        <span class="tooltip" role="tooltip" id="tooltip-pm">
          Effets sur la santé :
          <br>PM10 : Peut irriter les voies respiratoires, surtout chez les personnes souffrant d'asthme.
          <br>PM2.5 : Risque accru de maladies cardiovasculaires et respiratoires.
        </span>
      </span>
    </h6>
    <div class="info-value">
      <div class="pollution-category">
        PM10 : <span class="{% if PM10 == 'Risque nul' %}risque-nul{% elif PM10 == 'Bon' %}bon{% elif PM10 == 'Moyen' %}moyen{% else %}{{ pm10_class }}{% endif %}">{{ PM10 }}</span><br>
        PM2.5 : <span class="{% if PM25 == 'Risque nul' %}risque-nul{% elif PM25 == 'Bon' %}bon{% elif PM25 == 'Moyen' %}moyen{% else %}{{ pm25_class }}{% endif %}">{{ PM25 }}</span>
      </div>
    </div>
    {% if PM10 != 'Bon' and PM10 != 'Moyen' or PM25 != 'Bon' and PM25 != 'Moyen' %}
    <div class="recommendations">
      <strong>Recommandations :</strong>
      {% if PM10 == 'Dégradée' or PM25 == 'Dégradée' %}
      <p>Les niveaux de particules sont modérés. Les personnes sensibles devraient limiter les efforts prolongés à
        l'extérieur.</p>
      {% elif PM10 == 'Mauvaise' or PM25 == 'Mauvaise' %}
      <p>Limitez les activités physiques intenses en extérieur, surtout pour les personnes sensibles.</p>
      {% elif PM10 == 'Très mauvaise' or PM25 == 'Très mauvaise' %}
      <p>Les niveaux de particules en suspension sont extrêmement élevés. Les personnes vulnérables (enfants, personnes
        âgées, personnes atteintes de maladies respiratoires) devraient éviter toute activité en extérieur.</p>
      {% endif %}
    </div>
    {% endif %}
  </div>


  <!-- Gaseous Pollutants Pollution Tile -->
  <div class="info-card">
    <h6>
      <i class="fas fa-smog icon"></i>
      Gaz polluants
      <span class="info-icon" tabindex="0" aria-describedby="tooltip-gaz">
        i
        <span class="tooltip" role="tooltip" id="tooltip-gaz">
          Effets sur la santé :
          <br>Ozone (O₃) : Peut aggraver l'asthme et augmenter les réactions allergiques.
          <br>NO₂ : Contribue à l'inflammation pulmonaire.
          <br>SO₂ : Peut irriter les yeux et les voies respiratoires.
        </span>
      </span>
    </h6>
    <div class="info-value">
      <div class="pollution-category">
        Ozone (O<sub>3</sub>) : <span class="{% if O3 == 'Risque nul' %}risque-nul{% elif O3 == 'Bon' %}bon{% elif O3 == 'Moyen' %}moyen{% else %}{{ o3_class }}{% endif %}">{{ O3 }}</span><br>
        NO<sub>2</sub> : <span class="{% if NO2 == 'Risque nul' %}risque-nul{% elif NO2 == 'Bon' %}bon{% elif NO2 == 'Moyen' %}moyen{% else %}{{ no2_class }}{% endif %}">{{ NO2 }}</span><br>
        SO<sub>2</sub> : <span class="{% if SO2 == 'Risque nul' %}risque-nul{% elif SO2 == 'Bon' %}bon{% elif SO2 == 'Moyen' %}moyen{% else %}{{ so2_class }}{% endif %}">{{ SO2 }}</span>
      </div>
    </div>

    {% if O3 != 'Faible' or NO2 != 'Faible' or SO2 != 'Faible' %}
    <div class="recommendations">
      <strong>Recommandations :</strong>
      {% if O3 == 'Moyen' or NO2 == 'Moyen' or SO2 == 'Moyen' %}
      <p>Les niveaux des gaz polluants sont modérés. Si vous avez des problèmes respiratoires, prenez des précautions en
        limitant les efforts prolongés.</p>
      {% elif O3 == 'Dégradée' or NO2 == 'Dégradée' or SO2 == 'Dégradée' %}
      <p>Les niveaux de gaz sont dégradés. Si vous avez des problèmes respiratoires, évitez les efforts prolongés à
        l'extérieur.</p>
      {% elif O3 == 'Mauvaise' or NO2 == 'Mauvaise' or SO2 == 'Mauvaise' %}
      <p>Les personnes vulnérables devraient limiter leurs activités extérieures, particulièrement pendant les heures de
        pointe de pollution.</p>
      {% elif O3 == 'Très mauvaise' or NO2 == 'Très mauvaise' or SO2 == 'Très mauvaise' %}
      <p>Les niveaux de gaz polluants sont extrêmement élevés. Restez à l'intérieur, fermez les fenêtres, et évitez
        toute activité en extérieur.</p>
      {% endif %}
    </div>
    {% endif %}
  </div>

  <div class="info-card">
    <h6>
      <i class="fas fa-leaf icon"></i> Pollens
    </h6>
    <div class="pollen-columns">
      <!-- Dynamically colored tiles for each pollen type -->
      {% for pollen_type, pollen_level in pollen_data.pollen_levels.items %}
      <div class="pollen-tile {% if pollen_level == 'Risque nul' %}risque-nul{% else %}{{ pollen_level|lower }}{% endif %}">
        <p>{{ pollen_type|capfirst }}</p>
        <span class="pollen-level">{{ pollen_level }}</span>
      </div>
      
      <!-- Specific recommendations based on pollen level -->
      {% if pollen_level != 'Risque nul' %}
        <div class="recommendations">
          <strong>Recommandations pour {{ pollen_type|capfirst }} :</strong>
          {% if pollen_level == 'Faible' %}
            <p>Risque faible. Vous pouvez sortir, mais restez vigilant.</p>
          {% elif pollen_level == 'Modérée' %}
            <p>Risque modéré. Soyez prudent et envisagez de rester à l'intérieur pendant les heures de pointe.</p>
          {% elif pollen_level == 'Élevée' %}
            <p>Risque élevé. Limitez les activités extérieures, surtout si vous êtes allergique.</p>
          {% elif pollen_level == 'Très élevée' %}
            <p>Risque très élevé. Évitez de sortir et prenez des traitements antiallergiques.</p>
          {% endif %}
        </div>
      {% endif %}
      {% endfor %}
    </div>
    
  </div>
  
  <!-- Style for the 4-column pollen section -->
  <style>
    .pollen-columns {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* 4 columns for laptop and larger */
      gap: 10px; /* Space between the tiles */
    }
  
    .pollen-tile {
      background-color: #f1f1f1;
      border-radius: 6px;
      padding: 8px;
      text-align: center;
      color: white;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Slight shadow */
    }
  
    .pollen-tile p {
      margin: 0;
      font-size: 14px; /* Compact font size */
    }
  
    .pollen-tile .pollen-level {
      font-size: 18px; /* Slightly reduced font size */
      margin-top: 3px;
    }
  
    /* Dynamic coloring based on pollen level */
    .bon {
      color: #34c759 !important; /* Green color for good air quality */
    }
    
    .moyen {
      color: #ffcc00 !important; /* Yellow color for moderate air quality */
    }
    
    /* Other classes for reference */
    .degrade {
      color: #ff9500 !important; /* Orange color for degraded quality */
    }
    
    .mauvais {
      color: #ff3b30 !important; /* Red color for poor quality */
    }
    
    .tres-mauvais {
      color: #c40000 !important; /* Dark red for very poor quality */
    }
    .risque-nul {
      color: #34c759 !important; /* Green color for null risk */
    }
  
    .tres-mauvais {
      background-color: #c40000;
    }
  
    /* Style for the info card */
    .info-card {
      background-color: #f1f1f1;
      border-radius: 10px;
      padding: 10px;
      width: 100%; /* Full width */
      box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.05); /* Slightly smaller shadow */
      transition: transform 0.3s ease, background-color 0.3s ease;
    }
  
    .info-card:hover {
      transform: translateY(-3px);
      background-color: #fafafa;
    }
  
    .recommendations {
      margin-top: 10px;
      padding: 8px;
      background-color: #ffe5e5;
      border-left: 4px solid #ff3b30;
      font-size: 12px; /* Smaller font size for recommendations */
      color: #c40000;
    }
  
    /* Force 4 columns on laptop screens and larger */
    @media (max-width: 1200px) {
      .pollen-columns {
        grid-template-columns: repeat(4, 1fr); /* Force 4 columns on laptop size */
      }
    }
  
    /* Responsive design: adjust the layout for smaller screens */
    @media (max-width: 768px) {
      .pollen-columns {
        grid-template-columns: repeat(2, 1fr); /* Switch to 2 columns on smaller screens */
      }
    }
  
    @media (max-width: 480px) {
      .pollen-columns {
        grid-template-columns: 1fr; /* Switch to 1 column on very small screens */
      }
    }
  </style>
    <h6>Légende :</h6>
    <div class="faible">Faible</div>
    <div class="moyen">Moyen</div>

    <div class="mauvais">Mauvaise</div>

  </div>
</div>


{% endblock %}