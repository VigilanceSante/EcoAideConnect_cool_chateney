{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Formulaire de Contact - Aide aux Personnes Âgées et Handicapées{% endblock %}

{% block content %}
<div class="container-fluid py-5">
  <h4 class="text-center mb-4">
    <span class="text-muted fw-light">Je me propose /</span> Formulaire de contact
  </h4>
  {% if success_message %}
  <div class="alert alert-success" role="alert">
    {{ success_message }}
  </div>
  {% endif %}

  <!-- Basic Layout -->
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Formulaire de Contact</h5>
        </div>
        <div class="card-body">
          <form method="post">
            {% csrf_token %}

            <div class="mb-4">
              <label class="form-label" for="{{ form.first_name.id_for_label }}">Prénom</label>
              <div class="input-group">
                <span class="input-group-text bg-light"><i class="bx bx-user"></i></span>
                {{ form.first_name }}
              </div>
            </div>
            <div class="mb-4">
              <label class="form-label" for="{{ form.last_name.id_for_label }}">Nom</label>
              <div class="input-group">
                <span class="input-group-text bg-light"><i class="bx bx-user"></i></span>
                {{ form.last_name }}
              </div>
            </div>
            <div class="mb-4">
              <label class="form-label" for="{{ form.email.id_for_label }}">Email</label>
              <div class="input-group">
                <span class="input-group-text bg-light"><i class="bx bx-envelope"></i></span>
                {{ form.email }}
              </div>
              <div class="form-text">Vous pouvez utiliser des lettres, des chiffres et des points.</div>
            </div>
            <div class="mb-4">
              <label class="form-label" for="{{ form.phone.id_for_label }}">Téléphone</label>
              <div class="input-group">
                <span class="input-group-text bg-light"><i class="bx bx-phone"></i></span>
                {{ form.phone }}
              </div>
            </div>
            <div class="mb-4">
              <label class="form-label" for="{{ form.address.id_for_label }}">Adresse</label>
              <div class="input-group">
                <span class="input-group-text bg-light"><i class="bx bx-map"></i></span>
                {{ form.address }}
              </div>
            </div>
            <div class="mb-4">
              <label class="form-label">Disponibilités</label>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Lundi</label>
                  <div class="form-check">
                    {{ form.monday_all_day }}
                    <label class="form-check-label" for="{{ form.monday_all_day.id_for_label }}">Toute la journée</label>
                  </div>
                  <div class="form-check">
                    {{ form.monday_morning }}
                    <label class="form-check-label" for="{{ form.monday_morning.id_for_label }}">Matin</label>
                  </div>
                  <div class="form-check">
                    {{ form.monday_afternoon }}
                    <label class="form-check-label" for="{{ form.monday_afternoon.id_for_label }}">Après-midi</label>
                  </div>
                  <div class="form-check">
                    {{ form.monday_evening }}
                    <label class="form-check-label" for="{{ form.monday_evening.id_for_label }}">Soirée</label>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Mardi</label>
                  <div class="form-check">
                    {{ form.tuesday_all_day }}
                    <label class="form-check-label" for="{{ form.tuesday_all_day.id_for_label }}">Toute la journée</label>
                  </div>
                  <div class="form-check">
                    {{ form.tuesday_morning }}
                    <label class="form-check-label" for="{{ form.tuesday_morning.id_for_label }}">Matin</label>
                  </div>
                  <div class="form-check">
                    {{ form.tuesday_afternoon }}
                    <label class="form-check-label" for="{{ form.tuesday_afternoon.id_for_label }}">Après-midi</label>
                  </div>
                  <div class="form-check">
                    {{ form.tuesday_evening }}
                    <label class="form-check-label" for="{{ form.tuesday_evening.id_for_label }}">Soirée</label>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Mercredi</label>
                  <div class="form-check">
                    {{ form.wednesday_all_day }}
                    <label class="form-check-label" for="{{ form.wednesday_all_day.id_for_label }}">Toute la journée</label>
                  </div>
                  <div class="form-check">
                    {{ form.wednesday_morning }}
                    <label class="form-check-label" for="{{ form.wednesday_morning.id_for_label }}">Matin</label>
                  </div>
                  <div class="form-check">
                    {{ form.wednesday_afternoon }}
                    <label class="form-check-label" for="{{ form.wednesday_afternoon.id_for_label }}">Après-midi</label>
                  </div>
                  <div class="form-check">
                    {{ form.wednesday_evening }}
                    <label class="form-check-label" for="{{ form.wednesday_evening.id_for_label }}">Soirée</label>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Jeudi</label>
                  <div class="form-check">
                    {{ form.thursday_all_day }}
                    <label class="form-check-label" for="{{ form.thursday_all_day.id_for_label }}">Toute la journée</label>
                  </div>
                  <div class="form-check">
                    {{ form.thursday_morning }}
                    <label class="form-check-label" for="{{ form.thursday_morning.id_for_label }}">Matin</label>
                  </div>
                  <div class="form-check">
                    {{ form.thursday_afternoon }}
                    <label class="form-check-label" for="{{ form.thursday_afternoon.id_for_label }}">Après-midi</label>
                  </div>
                  <div class="form-check">
                    {{ form.thursday_evening }}
                    <label class="form-check-label" for="{{ form.thursday_evening.id_for_label }}">Soirée</label>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Vendredi</label>
                  <div class="form-check">
                    {{ form.friday_all_day }}
                    <label class="form-check-label" for="{{ form.friday_all_day.id_for_label }}">Toute la journée</label>
                  </div>
                  <div class="form-check">
                    {{ form.friday_morning }}
                    <label class="form-check-label" for="{{ form.friday_morning.id_for_label }}">Matin</label>
                  </div>
                  <div class="form-check">
                    {{ form.friday_afternoon }}
                    <label class="form-check-label" for="{{ form.friday_afternoon.id_for_label }}">Après-midi</label>
                  </div>
                  <div class="form-check">
                    {{ form.friday_evening }}
                    <label class="form-check-label" for="{{ form.friday_evening.id_for_label }}">Soirée</label>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Samedi</label>
                  <div class="form-check">
                    {{ form.saturday_all_day }}
                    <label class="form-check-label" for="{{ form.saturday_all_day.id_for_label }}">Toute la journée</label>
                  </div>
                  <div class="form-check">
                    {{ form.saturday_morning }}
                    <label class="form-check-label" for="{{ form.saturday_morning.id_for_label }}">Matin</label>
                  </div>
                  <div class="form-check">
                    {{ form.saturday_afternoon }}
                    <label class="form-check-label" for="{{ form.saturday_afternoon.id_for_label }}">Après-midi</label>
                  </div>
                  <div class="form-check">
                    {{ form.saturday_evening }}
                    <label class="form-check-label" for="{{ form.saturday_evening.id_for_label }}">Soirée</label>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Dimanche</label>
                  <div class="form-check">
                    {{ form.sunday_all_day }}
                    <label class="form-check-label" for="{{ form.sunday_all_day.id_for_label }}">Toute la journée</label>
                  </div>
                  <div class="form-check">
                    {{ form.sunday_morning }}
                    <label class="form-check-label" for="{{ form.sunday_morning.id_for_label }}">Matin</label>
                  </div>
                  <div class="form-check">
                    {{ form.sunday_afternoon }}
                    <label class="form-check-label" for="{{ form.sunday_afternoon.id_for_label }}">Après-midi</label>
                  </div>
                  <div class="form-check">
                    {{ form.sunday_evening }}
                    <label class="form-check-label" for="{{ form.sunday_evening.id_for_label }}">Soirée</label>
                  </div>
                </div>
              </div>
            </div>

            <button type="submit" class="btn btn-primary w-100">Envoyer</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .input-group-text,
  .form-control {
    border: none;
    box-shadow: none;
  }
</style>

<script>
  document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const day = this.id.split('_')[0];
      const isAllDayChecked = this.checked && this.value === 'toute_la_journee';

      const checkboxes = document.querySelectorAll(`input[id^="${day}_"]`);
      const allDayCheckbox = document.querySelector(`#${day}_all_day`);
      const morningCheckbox = document.querySelector(`#${day}_morning`);
      const afternoonCheckbox = document.querySelector(`#${day}_afternoon`);
      const eveningCheckbox = document.querySelector(`#${day}_evening`);

      if (isAllDayChecked) {
        checkboxes.forEach(cb => {
          if (cb.value !== 'toute_la_journee') {
            cb.disabled = true;
            cb.checked = false;
          }
        });
      } else {
        const allChecked = morningCheckbox.checked && afternoonCheckbox.checked && eveningCheckbox.checked;
        allDayCheckbox.checked = allChecked;
        checkboxes.forEach(cb => {
          if (cb.value !== 'toute_la_journee') {
            cb.disabled = allChecked;
          }
        });
      }

      if (this.value === 'toute_la_journee' && !this.checked) {
        checkboxes.forEach(cb => {
          if (cb.value !== 'toute_la_journee') {
            cb.disabled = false;
          }
        });
      }
    });
  });

  // Ensure "Toute la journée" is checked if all periods are checked on page load
  document.querySelectorAll('.form-check-label').forEach(label => {
    const day = label.htmlFor.split('_')[0];
    const allDayCheckbox = document.querySelector(`#${day}_all_day`);
    const morningCheckbox = document.querySelector(`#${day}_morning`);
    const afternoonCheckbox = document.querySelector(`#${day}_afternoon`);
    const eveningCheckbox = document.querySelector(`#${day}_evening`);

    if (morningCheckbox.checked && afternoonCheckbox.checked && eveningCheckbox.checked) {
      allDayCheckbox.checked = true;
      document.querySelectorAll(`input[id^="${day}_"]`).forEach(cb => {
        if (cb.value !== 'toute_la_journee') {
          cb.disabled = true;
        }
      });
    }
  });
</script>

{% endblock %}